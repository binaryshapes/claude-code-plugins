# Python Library Tasks
# Inherited by all Python libraries

inheritedBy:
  toolchains: ['python']
  layers: ['library']

fileGroups:
  sources:
    - 'src/**/*.py'
    - '**/*.py'
    - '!tests/**/*.py'
    - '!**/test_*.py'
  tests:
    - 'tests/**/*.py'
    - '**/test_*.py'
    - '**/*_test.py'
  configs:
    - 'pyproject.toml'
    - 'ruff.toml'
    - 'mypy.ini'

implicitInputs:
  - 'pyproject.toml'

tasks:
  build:
    command: 'uv build'
    inputs:
      - '@group(sources)'
      - '@group(configs)'
    outputs:
      - 'dist'

  lint:
    command: 'uv run ruff check src tests'
    inputs:
      - '@group(sources)'
      - '@group(tests)'

  format:
    command: 'uv run ruff format src tests'

  format-check:
    command: 'uv run ruff format --check src tests'
    inputs:
      - '@group(sources)'
      - '@group(tests)'

  typecheck:
    command: 'uv run mypy src'
    inputs:
      - '@group(sources)'

  test:
    command: 'uv run pytest'
    inputs:
      - '@group(sources)'
      - '@group(tests)'

  install:
    command: 'uv sync'

  clean:
    command: 'rm -rf dist .pytest_cache .mypy_cache .ruff_cache __pycache__'
