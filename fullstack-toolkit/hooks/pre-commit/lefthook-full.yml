# Full Lefthook configuration for TypeScript + Python monorepo
# Copy this to your project's lefthook.yml

pre-commit:
  parallel: true
  commands:
    # TypeScript checks
    ts-lint:
      glob: "*.{ts,tsx,js,jsx}"
      run: pnpm eslint --max-warnings=0 {staged_files}
      stage_fixed: true

    ts-format:
      glob: "*.{ts,tsx,js,jsx,json,md,yml,yaml}"
      run: pnpm prettier --check {staged_files}

    ts-typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm typecheck

    # Python checks
    py-lint:
      glob: "*.py"
      run: uv run ruff check {staged_files}
      stage_fixed: true

    py-format:
      glob: "*.py"
      run: uv run ruff format --check {staged_files}

    py-typecheck:
      glob: "*.py"
      run: uv run mypy {staged_files} --ignore-missing-imports

    # Commit message validation
    commit-msg:
      run: |
        if ! echo "$1" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,50}"; then
          echo "Invalid commit message format"
          echo "Expected: type(scope): description"
          exit 1
        fi
      skip:
        - merge
        - rebase

pre-push:
  parallel: true
  commands:
    # Run tests before push
    ts-test:
      glob: "*.{ts,tsx}"
      run: pnpm test --run

    py-test:
      glob: "*.py"
      run: uv run pytest -x

    # Security audit
    audit:
      run: |
        pnpm audit --audit-level=high || true
        uv pip check || true
